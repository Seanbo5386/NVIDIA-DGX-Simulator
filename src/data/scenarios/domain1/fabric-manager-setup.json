{
  "id": "domain1-fabric-manager",
  "title": "Fabric Manager Configuration and Validation",
  "domain": "domain1",
  "difficulty": "advanced",
  "description": "Learn how to configure and validate NVIDIA Fabric Manager for NVSwitch-based GPU systems. Fabric Manager is essential for managing the NVLink fabric topology in DGX systems.",
  "learningObjectives": [
    "Understand Fabric Manager role and architecture",
    "Verify Fabric Manager service status",
    "Check NVSwitch discovery and configuration",
    "Validate NVLink fabric topology",
    "Troubleshoot Fabric Manager issues"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Understand Fabric Manager Architecture",
      "description": "Learn the role of Fabric Manager in managing NVSwitch-based GPU interconnect topologies.",
      "objectives": [
        "Understand FM's role in NVSwitch systems",
        "Learn about NVLink fabric topology",
        "Know FM requirements and dependencies"
      ],
      "expectedCommands": [
        "nvidia-smi",
        "nvidia-smi topo -m"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check GPU topology",
          "expectedCommands": ["nvidia-smi", "nvidia-smi topo -m"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Fabric Manager manages NVSwitch-based topologies",
        "Required for DGX A100/H100 with NVSwitches",
        "FM initializes and monitors NVLink fabric",
        "Without FM, GPUs may not see full NVLink connectivity",
        "FM runs as nvidia-fabricmanager.service"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Fabric Manager Documentation",
          "url": "https://docs.nvidia.com/datacenter/tesla/fabric-manager-user-guide/"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Check Fabric Manager Service Status",
      "description": "Verify that Fabric Manager service is running and properly configured.",
      "objectives": [
        "Check FM service status",
        "Verify FM is enabled",
        "Review FM configuration"
      ],
      "expectedCommands": [
        "systemctl status nvidia-fabricmanager",
        "systemctl is-enabled nvidia-fabricmanager"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check FM service status",
          "expectedCommands": ["systemctl status nvidia-fabricmanager"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Service name: nvidia-fabricmanager",
        "Should show 'active (running)' status",
        "FM must start after nvidia driver loads",
        "Check 'enabled' for auto-start at boot",
        "Config file: /etc/nvidia-fabricmanager/fabricmanager.conf"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Fabric Manager Service",
          "url": "https://docs.nvidia.com/datacenter/tesla/fabric-manager-user-guide/"
        }
      ]
    },
    {
      "id": "step3",
      "title": "Verify NVSwitch Discovery",
      "description": "Check that Fabric Manager has discovered all NVSwitches in the system.",
      "objectives": [
        "Query NVSwitch inventory",
        "Verify all switches detected",
        "Check NVSwitch health"
      ],
      "expectedCommands": [
        "nvsm show nvswitch",
        "nvidia-smi nvlink --status"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify NVSwitch discovery",
          "expectedCommands": ["nvsm show nvswitch", "nvidia-smi nvlink --status"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "DGX A100 has 6 NVSwitches",
        "DGX H100 has 4 NVSwitches",
        "Use 'nvsm show nvswitch' for inventory",
        "All NVSwitches should show healthy status",
        "Missing NVSwitches indicate fabric issues"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "NVSwitch Architecture",
          "url": "https://docs.nvidia.com/datacenter/nvlink/"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Validate NVLink Fabric Topology",
      "description": "Verify the complete NVLink fabric topology and GPU interconnections.",
      "objectives": [
        "Check NVLink topology matrix",
        "Verify all GPU connections",
        "Identify any degraded links"
      ],
      "expectedCommands": [
        "nvidia-smi topo -m",
        "nvidia-smi nvlink --status -i 0"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must validate NVLink topology",
          "expectedCommands": ["nvidia-smi topo -m", "nvidia-smi nvlink --status"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Topology matrix shows NV# for NVLink connections",
        "All GPUs should connect via NVLink (NV12 for A100, NV18 for H100)",
        "SYS indicates PCIe connection (no direct NVLink)",
        "Check each GPU's NVLink status for errors",
        "Inactive links indicate fabric issues"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "GPU Topology",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Review Fabric Manager Logs",
      "description": "Check Fabric Manager logs for initialization status and any errors.",
      "objectives": [
        "Access FM logs",
        "Identify successful initialization",
        "Find any error messages"
      ],
      "expectedCommands": [
        "journalctl -u nvidia-fabricmanager --no-pager | tail -50",
        "cat /var/log/nvidia-fabricmanager.log | head -100"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must review FM logs",
          "expectedCommands": ["journalctl -u nvidia-fabricmanager"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use journalctl for systemd logs",
        "Log file also at /var/log/nvidia-fabricmanager.log",
        "Look for 'Fabric Manager started' message",
        "Check for NVSwitch initialization messages",
        "Errors during startup indicate configuration issues"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "FM Troubleshooting",
          "url": "https://docs.nvidia.com/datacenter/tesla/fabric-manager-user-guide/"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Check NVLink Error Counters",
      "description": "Monitor NVLink error counters to ensure fabric health.",
      "objectives": [
        "Query NVLink error counters",
        "Understand error types",
        "Identify problematic links"
      ],
      "expectedCommands": [
        "nvidia-smi nvlink -e",
        "nvidia-smi nvlink --capabilities"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check NVLink errors",
          "expectedCommands": ["nvidia-smi nvlink -e", "nvidia-smi nvlink --capabilities"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi nvlink -e' for error counters",
        "CRC errors indicate signal integrity issues",
        "Replay counts show retransmissions",
        "High error counts may indicate cable issues",
        "Reset counters after investigation"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "NVLink Troubleshooting",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step7",
      "title": "Test GPU-to-GPU Bandwidth",
      "description": "Validate NVLink fabric bandwidth using peer-to-peer bandwidth test.",
      "objectives": [
        "Understand P2P bandwidth testing",
        "Know expected bandwidth values",
        "Verify fabric performance"
      ],
      "expectedCommands": [
        "nvidia-smi topo -m",
        "nvidia-smi nvlink --status"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify fabric performance",
          "expectedCommands": ["nvidia-smi topo -m", "nvidia-smi nvlink --status"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "P2P bandwidth test available in CUDA samples",
        "A100: ~600 GB/s bidirectional per GPU pair",
        "H100: ~900 GB/s bidirectional per GPU pair",
        "Low bandwidth indicates fabric issues",
        "Run bandwidth tests after FM initialization"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "NVLink Bandwidth",
          "url": "https://docs.nvidia.com/datacenter/nvlink/"
        }
      ]
    }
  ],
  "successCriteria": [
    "Understood Fabric Manager architecture",
    "Verified FM service status",
    "Confirmed NVSwitch discovery",
    "Validated NVLink topology",
    "Reviewed FM logs",
    "Checked NVLink error counters",
    "Understood bandwidth validation"
  ],
  "estimatedTime": 45,
  "prerequisites": ["domain1-driver-install"],
  "tags": ["fabric-manager", "nvswitch", "nvlink", "topology", "advanced"]
}
