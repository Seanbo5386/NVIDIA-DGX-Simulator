{
  "id": "domain4-hpl-workflow",
  "title": "HPL Benchmark Workflow and Analysis",
  "domain": "domain4",
  "difficulty": "advanced",
  "description": "Learn the complete HPL (High-Performance LINPACK) benchmark workflow for validating DGX system performance. HPL measures the system's floating-point computational capability.",
  "learningObjectives": [
    "Understand HPL benchmark purpose",
    "Configure HPL parameters",
    "Run HPL on DGX systems",
    "Interpret HPL results",
    "Compare against baseline performance"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Understand HPL Benchmark",
      "description": "Learn what HPL measures and why it's important for system validation.",
      "objectives": [
        "Understand LINPACK benchmark",
        "Know HPL metrics (TFLOPS, efficiency)",
        "Learn typical DGX performance targets"
      ],
      "expectedCommands": [
        "nvidia-smi",
        "nvidia-smi -q | grep -i \"product name\\|memory\"",
        "nproc"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must understand system capabilities",
          "expectedCommands": ["nvidia-smi", "nvidia-smi -q"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "HPL solves dense linear system Ax=b",
        "Measures FP64 (double precision) performance",
        "TFLOPS = Trillion floating-point ops/sec",
        "Efficiency = actual/theoretical performance",
        "DGX A100: ~10-12 TFLOPS, DGX H100: ~30+ TFLOPS"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "HPL Benchmark",
          "url": "https://www.netlib.org/benchmark/hpl/"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Verify System Readiness",
      "description": "Ensure system is properly configured for benchmarking.",
      "objectives": [
        "Check GPU health",
        "Verify NVLink topology",
        "Ensure no other workloads"
      ],
      "expectedCommands": [
        "nvidia-smi",
        "nvidia-smi topo -m",
        "nvidia-smi nvlink --status"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify system readiness",
          "expectedCommands": ["nvidia-smi", "nvidia-smi topo -m", "nvidia-smi nvlink --status"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "All GPUs should be visible and healthy",
        "NVLink topology should be fully connected",
        "No other processes using GPUs",
        "Thermal throttling will reduce performance",
        "Check GPU memory is fully available"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Pre-Benchmark Checks",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step3",
      "title": "Configure HPL Parameters",
      "description": "Set up HPL input file (HPL.dat) with optimal parameters.",
      "objectives": [
        "Understand HPL.dat parameters",
        "Configure problem size (N)",
        "Set block size (NB)"
      ],
      "expectedCommands": [
        "cat HPL.dat",
        "nvidia-smi --query-gpu=memory.total --format=csv"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must configure HPL parameters",
          "expectedCommands": ["cat HPL.dat", "nvidia-smi --query-gpu=memory.total"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "N = matrix size (larger = more accurate, longer)",
        "NB = block size (typically 384-512 for GPUs)",
        "P x Q = process grid (match GPU count)",
        "N should use ~80% of GPU memory",
        "For 8x A100-80GB: N ~ 200000"
      ],
      "estimatedDuration": 10,
      "documentationLinks": [
        {
          "title": "HPL Configuration",
          "url": "https://www.netlib.org/benchmark/hpl/tuning.html"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Set Environment Variables",
      "description": "Configure environment for optimal HPL performance.",
      "objectives": [
        "Set GPU affinity",
        "Configure MPI settings",
        "Set memory options"
      ],
      "expectedCommands": [
        "export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7",
        "export UCX_TLS=rc,sm,cuda_copy,cuda_ipc",
        "env | grep -E 'CUDA|UCX|MPI'"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must set environment variables",
          "expectedCommands": ["export CUDA_VISIBLE_DEVICES", "env | grep CUDA"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "CUDA_VISIBLE_DEVICES controls GPU selection",
        "UCX settings optimize communication",
        "GPU Direct RDMA for multi-node",
        "NVIDIA HPC-X MPI recommended",
        "Affinity settings affect performance"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "HPL Environment",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Run HPL Benchmark",
      "description": "Execute HPL benchmark and monitor progress.",
      "objectives": [
        "Launch HPL with MPI",
        "Monitor GPU utilization",
        "Track progress"
      ],
      "expectedCommands": [
        "mpirun -np 8 ./xhpl",
        "nvidia-smi dmon -s puc -d 5"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must run HPL benchmark",
          "expectedCommands": ["mpirun -np 8", "nvidia-smi dmon"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "NGC HPL container available",
        "mpirun -np <gpus> ./xhpl",
        "Monitor GPU utilization during run",
        "Run takes 10-60+ minutes",
        "High utilization indicates good config"
      ],
      "estimatedDuration": 10,
      "documentationLinks": [
        {
          "title": "Running HPL",
          "url": "https://catalog.ngc.nvidia.com/orgs/nvidia/containers/hpc-benchmarks"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Interpret HPL Results",
      "description": "Analyze HPL output and understand performance metrics.",
      "objectives": [
        "Read HPL output format",
        "Calculate efficiency",
        "Identify performance issues"
      ],
      "expectedCommands": [
        "cat hpl_results.txt | grep -E 'WR|Gflops|Time'",
        "nvidia-smi -q | grep -i \"product name\\|power\""
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must interpret HPL results",
          "expectedCommands": ["cat hpl_results.txt", "nvidia-smi -q"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Look for 'WR' line with Gflops result",
        "Time shows benchmark duration",
        "Efficiency = Gflops / theoretical_peak",
        "DGX A100: ~85-92% efficiency expected",
        "DGX H100: ~85-92% efficiency expected"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "HPL Output",
          "url": "https://www.netlib.org/benchmark/hpl/"
        }
      ]
    },
    {
      "id": "step7",
      "title": "Compare Against Baseline",
      "description": "Compare results with expected baseline performance.",
      "objectives": [
        "Know baseline performance",
        "Calculate efficiency percentage",
        "Identify deviations"
      ],
      "expectedCommands": [
        "nvidia-smi -q | grep -i \"product name\"",
        "echo \"DGX A100 8-GPU baseline: ~10.5 TFLOPS\"",
        "echo \"DGX H100 8-GPU baseline: ~30+ TFLOPS\""
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must compare against baseline",
          "expectedCommands": ["nvidia-smi -q | grep -i product"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "DGX A100 80GB: ~10-12 TFLOPS (8 GPU)",
        "DGX H100: ~30-34 TFLOPS (8 GPU)",
        "Results within 5% of baseline are good",
        ">10% below baseline indicates issues",
        "Document results for acceptance testing"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "DGX Baseline Performance",
          "url": "https://docs.nvidia.com/dgx/"
        }
      ]
    },
    {
      "id": "step8",
      "title": "Troubleshoot Low Performance",
      "description": "Diagnose causes of suboptimal HPL performance.",
      "objectives": [
        "Check for thermal throttling",
        "Verify NVLink health",
        "Identify bottlenecks"
      ],
      "expectedCommands": [
        "nvidia-smi -q -d PERFORMANCE",
        "nvidia-smi nvlink -e",
        "nvidia-smi -q -d CLOCK"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must troubleshoot low performance",
          "expectedCommands": ["nvidia-smi -q -d PERFORMANCE", "nvidia-smi nvlink -e"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Check for thermal throttling",
        "Verify clocks at maximum",
        "NVLink errors reduce bandwidth",
        "Wrong HPL parameters hurt efficiency",
        "Memory errors cause performance issues"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "Performance Troubleshooting",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    }
  ],
  "successCriteria": [
    "Understood HPL benchmark purpose",
    "Verified system readiness",
    "Configured HPL parameters",
    "Set environment variables",
    "Ran HPL benchmark",
    "Interpreted HPL results",
    "Compared against baseline",
    "Troubleshot performance issues"
  ],
  "estimatedTime": 55,
  "prerequisites": ["domain1-driver-install", "domain2-nvlink-topo"],
  "tags": ["hpl", "linpack", "benchmark", "performance", "validation", "advanced"]
}
