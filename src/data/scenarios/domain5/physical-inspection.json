{
  "id": "domain5-physical-inspection",
  "title": "Physical Hardware Inspection Checklist",
  "domain": "domain5",
  "difficulty": "beginner",
  "description": "Learn the essential physical inspection steps for GPU systems. Proper physical inspection can identify problems that software diagnostics may miss, such as cable issues, seating problems, and thermal concerns.",
  "learningObjectives": [
    "Identify physical hardware components",
    "Check for proper seating of components",
    "Verify cable connections",
    "Document hardware serial numbers"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Document System Information",
      "description": "Before any physical inspection, document the system's current state. This helps track changes and provides baseline information for support cases.",
      "objectives": ["Gather system identification info"],
      "expectedCommands": ["dmidecode -t system", "ipmitool fru print"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Get system information",
          "expectedCommands": ["dmidecode", "ipmitool fru"],
          "requireAllCommands": false
        }
      ],
      "hints": ["dmidecode shows BIOS and system manufacturer info"],
      "enhancedHints": [
        {
          "id": "step1-hint1",
          "level": 1,
          "message": "dmidecode reads hardware info from BIOS/UEFI tables",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        },
        {
          "id": "step1-hint2",
          "level": 2,
          "message": "Try: dmidecode -t system | grep -E 'Manufacturer|Product|Serial'",
          "trigger": { "type": "time-based", "timeSeconds": 60 }
        }
      ],
      "estimatedDuration": 3,
      "documentationLinks": [
        { "title": "DGX Hardware Guide", "url": "https://docs.nvidia.com/dgx/dgx-os-6-user-guide/hardware.html" }
      ]
    },
    {
      "id": "step2",
      "title": "Verify GPU Presence and Seating",
      "description": "Verify all GPUs are detected by the system. Missing GPUs may indicate seating issues, riser card problems, or failed hardware.",
      "objectives": ["Confirm all GPUs are detected"],
      "expectedCommands": ["nvidia-smi -L", "lspci | grep -i nvidia"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "List GPUs",
          "expectedCommands": ["nvidia-smi -L", "lspci"],
          "requireAllCommands": false
        }
      ],
      "hints": ["nvidia-smi -L lists all detected GPUs"],
      "enhancedHints": [
        {
          "id": "step2-hint1",
          "level": 1,
          "message": "DGX H100 should show 8 GPUs, A100 systems typically 4 or 8",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        },
        {
          "id": "step2-hint2",
          "level": 2,
          "message": "If GPUs missing: check power, reseat cards, verify riser cards",
          "trigger": { "type": "time-based", "timeSeconds": 60 }
        }
      ],
      "estimatedDuration": 3
    },
    {
      "id": "step3",
      "title": "Check PCIe Bus Enumeration",
      "description": "Verify PCIe bus enumeration is correct. GPUs should appear at expected bus addresses. Unexpected addresses may indicate BIOS issues or hardware problems.",
      "objectives": ["Verify PCIe bus addresses"],
      "expectedCommands": ["lspci -tv", "nvidia-smi -q | grep -A2 'Bus Id'"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Check PCIe topology",
          "expectedCommands": ["lspci"],
          "requireAllCommands": true
        }
      ],
      "hints": ["lspci -tv shows PCIe tree structure"],
      "enhancedHints": [
        {
          "id": "step3-hint1",
          "level": 1,
          "message": "PCIe tree shows how devices connect through switches",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        },
        {
          "id": "step3-hint2",
          "level": 2,
          "message": "GPUs should be under PCIe switches, not directly on root ports",
          "trigger": { "type": "time-based", "timeSeconds": 60 }
        }
      ],
      "estimatedDuration": 3
    },
    {
      "id": "step4",
      "title": "Verify InfiniBand HCA Detection",
      "description": "Check that all InfiniBand Host Channel Adapters are detected. DGX systems typically have multiple HCAs for high-bandwidth networking.",
      "objectives": ["Confirm HCA detection"],
      "expectedCommands": ["ibstat", "lspci | grep -i mellanox"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Check InfiniBand HCAs",
          "expectedCommands": ["ibstat", "lspci"],
          "requireAllCommands": false
        }
      ],
      "hints": ["ibstat shows HCA port status"],
      "enhancedHints": [
        {
          "id": "step4-hint1",
          "level": 1,
          "message": "DGX H100 has 8 ConnectX-7 HCAs (400 Gb/s each)",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        },
        {
          "id": "step4-hint2",
          "level": 2,
          "message": "Missing HCAs may need reseating or cable checks",
          "trigger": { "type": "time-based", "timeSeconds": 60 }
        }
      ],
      "estimatedDuration": 3
    },
    {
      "id": "step5",
      "title": "Check Temperature Sensors",
      "description": "Review temperature readings for all components. Elevated temperatures may indicate cooling issues, blocked airflow, or failing fans.",
      "objectives": ["Review thermal status"],
      "expectedCommands": ["nvidia-smi -q | grep -A2 Temperature", "ipmitool sdr type temperature"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Check temperatures",
          "expectedCommands": ["nvidia-smi", "ipmitool sdr"],
          "requireAllCommands": false
        }
      ],
      "hints": ["GPU temps above 85°C under load may indicate cooling issues"],
      "enhancedHints": [
        {
          "id": "step5-hint1",
          "level": 1,
          "message": "Normal GPU idle temp: 35-50°C, Load: 65-83°C",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        },
        {
          "id": "step5-hint2",
          "level": 2,
          "message": "Check: fan speeds, air filters, room temperature, airflow path",
          "trigger": { "type": "time-based", "timeSeconds": 60 }
        }
      ],
      "estimatedDuration": 3
    },
    {
      "id": "step6",
      "title": "Document Hardware Inventory",
      "description": "Create a hardware inventory including serial numbers. This is essential for RMA requests and tracking hardware changes.",
      "objectives": ["Record serial numbers"],
      "expectedCommands": ["nvidia-smi -q | grep Serial", "ipmitool fru print 0"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Get serial numbers",
          "expectedCommands": ["nvidia-smi", "ipmitool fru"],
          "requireAllCommands": false
        }
      ],
      "hints": ["Serial numbers are needed for warranty and support"],
      "enhancedHints": [
        {
          "id": "step6-hint1",
          "level": 2,
          "message": "Document: GPU serials, NIC serials, chassis serial, BMC MAC",
          "trigger": { "type": "time-based", "timeSeconds": 45 }
        }
      ],
      "estimatedDuration": 5
    }
  ],
  "successCriteria": [
    "Documented system identification",
    "Verified all GPUs detected",
    "Checked PCIe enumeration",
    "Confirmed InfiniBand HCAs",
    "Reviewed thermal status",
    "Recorded hardware inventory"
  ],
  "estimatedTime": 20,
  "prerequisites": [],
  "tags": ["physical", "inspection", "hardware", "pcie", "thermal", "inventory", "domain5"]
}
