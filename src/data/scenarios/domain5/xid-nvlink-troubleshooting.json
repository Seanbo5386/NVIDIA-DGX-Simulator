{
  "id": "domain5-xid-nvlink",
  "title": "NVLink XID Error Troubleshooting: 72, 74, 76-78",
  "domain": "domain5",
  "difficulty": "advanced",
  "description": "Master troubleshooting NVLink-related XID errors that appear on the NCP-AII certification exam. This scenario covers XID 72 (flow control), XID 74 (general NVLink error), XID 76 (training failure), XID 77 (timeout), and XID 78 (NVLink ECC). These errors indicate problems in GPU-to-GPU communication fabric.",
  "learningObjectives": [
    "Identify NVLink-related XID error codes in logs",
    "Understand NVLink architecture and failure modes",
    "Use nvidia-smi nvlink commands for diagnostics",
    "Determine when hardware replacement is required",
    "Document findings for escalation"
  ],
  "faults": [
    {
      "nodeId": "dgx-02",
      "gpuId": 3,
      "type": "xid-error",
      "severity": "critical",
      "parameters": {
        "xidCode": 74,
        "description": "NVLink error detected"
      }
    }
  ],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Detect NVLink Errors in System Logs",
      "description": "NVLink errors are logged as XID codes 72, 74, 76, 77, and 78. Learn to identify these specific errors in system logs.",
      "objectives": [
        "Search dmesg for NVLink-related XID errors",
        "Identify affected GPU and link",
        "Note error frequency and timestamps"
      ],
      "expectedCommands": [
        "dmesg | grep -i xid",
        "dmesg | grep -i nvlink",
        "journalctl -k | grep -i 'xid.*7[2478]'"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must search for NVLink XID errors",
          "expectedCommands": ["dmesg | grep", "nvlink"]
        }
      ],
      "hints": [
        "XID 72: NVLink flow control - congestion or protocol error",
        "XID 74: General NVLink error - most common",
        "XID 76: NVLink training failure - link cannot establish",
        "XID 77: NVLink timeout - communication failed",
        "XID 78: NVLink ECC error - data corruption on link",
        "Multiple XID codes = cascading failure, investigate root cause"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "XID Error Reference",
          "url": "https://docs.nvidia.com/deploy/xid-errors/"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Check NVLink Topology and Status",
      "description": "Examine the NVLink topology to understand GPU interconnection and identify which links are affected.",
      "objectives": [
        "View GPU topology matrix",
        "Identify NVLink connections",
        "Check for missing or degraded links"
      ],
      "expectedCommands": [
        "nvidia-smi topo -m",
        "nvidia-smi nvlink -s",
        "nvidia-smi nvlink -s -i 3"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check NVLink topology",
          "expectedCommands": ["nvidia-smi topo", "nvidia-smi nvlink -s"]
        }
      ],
      "hints": [
        "Topology matrix: NV# = NVLink, SYS = PCIe/CPU",
        "'nvidia-smi nvlink -s' shows link status per GPU",
        "Active links should show 'Active' state",
        "Missing links indicate hardware failure",
        "DGX A100: 12 NVLinks per GPU, DGX H100: 18 NVLinks"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "NVLink Documentation",
          "url": "https://docs.nvidia.com/dgx/"
        }
      ]
    },
    {
      "id": "step3",
      "title": "Examine NVLink Error Counters",
      "description": "Check NVLink error counters to quantify the severity and identify specific failing links.",
      "objectives": [
        "Query NVLink error counters",
        "Identify links with non-zero errors",
        "Understand error types (replay, recovery, CRC)"
      ],
      "expectedCommands": [
        "nvidia-smi nvlink -e",
        "nvidia-smi nvlink -e -i 3",
        "dcgmi nvlink -e"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check NVLink error counters",
          "expectedCommands": ["nvidia-smi nvlink -e", "dcgmi nvlink"]
        }
      ],
      "hints": [
        "Replay errors: Link retransmitted data (recoverable)",
        "Recovery errors: Link had to reinitialize",
        "CRC errors: Data corruption detected",
        "Non-zero counters indicate link issues",
        "Rapidly increasing counters = active problem",
        "Compare both ends of link for correlation"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "NVLink Error Counters",
          "url": "https://docs.nvidia.com/deploy/"
        }
      ]
    },
    {
      "id": "step4",
      "title": "XID 72: Flow Control Analysis",
      "description": "XID 72 indicates NVLink flow control issues - the link is experiencing congestion or protocol errors.",
      "objectives": [
        "Understand flow control error cause",
        "Check for bandwidth bottlenecks",
        "Verify fabric manager status"
      ],
      "expectedCommands": [
        "systemctl status nv-fabricmanager",
        "nvidia-smi nvlink -s",
        "nvidia-smi dmon -s pucvmet"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must investigate XID 72",
          "expectedCommands": ["nv-fabricmanager", "nvidia-smi nvlink"]
        }
      ],
      "hints": [
        "XID 72 = Flow control credits exhausted",
        "CAUSES: Heavy multi-GPU traffic, fabric manager issue",
        "Check if fabric manager is running properly",
        "May indicate early link degradation",
        "Often precedes more severe XID 74/76 errors",
        "Monitor link utilization during workload"
      ],
      "estimatedDuration": 6,
      "documentationLinks": [
        {
          "title": "Fabric Manager Guide",
          "url": "https://docs.nvidia.com/datacenter/tesla/fabric-manager/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "XID 76: Training Failure Investigation",
      "description": "XID 76 indicates NVLink failed to complete link training - the physical connection cannot be established.",
      "objectives": [
        "Identify affected link",
        "Check physical connections",
        "Determine if reseat is needed"
      ],
      "expectedCommands": [
        "nvidia-smi nvlink -s",
        "lspci | grep -i nvidia",
        "nvidia-smi topo -m"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must investigate XID 76",
          "expectedCommands": ["nvidia-smi nvlink -s", "nvidia-smi topo"]
        }
      ],
      "hints": [
        "XID 76 = PHYSICAL CONNECTION PROBLEM",
        "Link cannot complete training handshake",
        "CAUSES: Bad NVLink bridge, GPU not seated, cable damage",
        "First action: Reseat GPU and NVLink bridges",
        "Check for bent pins or debris in connectors",
        "If reseat fails: Hardware replacement required"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "NVLink Hardware Guide",
          "url": "https://docs.nvidia.com/dgx/"
        }
      ]
    },
    {
      "id": "step6",
      "title": "XID 77/78: Critical NVLink Failures",
      "description": "XID 77 (timeout) and XID 78 (ECC error) indicate severe NVLink failures requiring immediate attention.",
      "objectives": [
        "Differentiate between timeout and ECC errors",
        "Check NVSwitch health if applicable",
        "Determine replacement requirements"
      ],
      "expectedCommands": [
        "nvidia-smi nvlink -e",
        "nvsm show health",
        "dcgmi diag -r 2"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must investigate XID 77/78",
          "expectedCommands": ["nvidia-smi nvlink -e", "dcgmi diag"]
        }
      ],
      "hints": [
        "XID 77 = NVLink operation timed out (link dead)",
        "XID 78 = Uncorrectable ECC error on NVLink data",
        "Both indicate HARDWARE FAILURE",
        "Check NVSwitch in DGX systems",
        "May need GPU replacement OR NVSwitch replacement",
        "Run dcgmi diag -r 2 for NVLink-specific tests"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "DGX Troubleshooting",
          "url": "https://docs.nvidia.com/dgx/"
        }
      ]
    },
    {
      "id": "step7",
      "title": "Document and Escalate",
      "description": "Create documentation for RMA or escalation when NVLink hardware failure is confirmed.",
      "objectives": [
        "Collect diagnostic information",
        "Generate bug report",
        "Document affected components"
      ],
      "expectedCommands": [
        "nvidia-bug-report.sh",
        "nvidia-smi -q > nvlink_diagnostics.txt",
        "nvidia-smi nvlink -e >> nvlink_diagnostics.txt"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must create documentation",
          "expectedCommands": ["nvidia-bug-report.sh", "nvlink_diagnostics"]
        }
      ],
      "hints": [
        "nvidia-bug-report.sh captures comprehensive diagnostics",
        "Document: GPU UUIDs, link IDs, error counts, timestamps",
        "For DGX: May need NVSwitch replacement, not just GPU",
        "Include workload that triggered errors",
        "Note if errors persist after reboot",
        "Submit with RMA request for faster processing"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "NVIDIA Support",
          "url": "https://www.nvidia.com/en-us/support/"
        }
      ]
    }
  ],
  "successCriteria": [
    "Identified NVLink XID errors in system logs",
    "Examined NVLink topology and status",
    "Analyzed NVLink error counters",
    "Understood XID 72 flow control issues",
    "Investigated XID 76 training failures",
    "Assessed XID 77/78 critical failures",
    "Created proper documentation for escalation"
  ],
  "estimatedTime": 45,
  "prerequisites": ["domain5-xid-errors"],
  "tags": [
    "xid-72",
    "xid-74",
    "xid-76",
    "xid-77",
    "xid-78",
    "nvlink",
    "troubleshooting",
    "advanced",
    "exam-critical"
  ],
  "tier": 3,
  "commandFamilies": ["gpu-monitoring", "diagnostics"],
  "explanationGateId": "gate-domain5-xid-nvlink",
  "toolHints": false
}
